*** Begin Patch
*** Update File: sphinxcontrib/soliditydomain/domain.py
@@
     def add_target_and_index(self, fullname, sig, signode):
-        if fullname not in self.state.document.ids:
-            signode['ids'].append(fullname2id(fullname))
-            self.state.document.note_explicit_target(signode)
-            objects = self.env.domaindata['sol']['objects']
-            if fullname in objects:
-                self.state_machine.reporter.warning(
-                    'duplicate {type} description of {fullname}, '
-                    'other instance in {otherloc}'.format(
-                        type=self.objtype,
-                        fullname=fullname,
-                        otherloc=objects[fullname][0],
-                    ), line=self.lineno)
-            objects[fullname] = (self.env.docname, self.objtype)
+        # Use the string id as the document id and as the storage key.
+        fid = fullname2id(fullname)
+        if fid not in self.state.document.ids:
+            signode['ids'].append(fid)
+            self.state.document.note_explicit_target(signode)
+            objects = self.env.domaindata.setdefault('sol', {}).setdefault('objects', {})
+            if fid in objects:
+                # objects[fid] is (docname, objtype, fullname)
+                otherloc = objects[fid][0]
+                self.state_machine.reporter.warning(
+                    'duplicate {type} description of {fullname}, '
+                    'other instance in {otherloc}'.format(
+                        type=self.objtype,
+                        fullname=fullname,
+                        otherloc=otherloc,
+                    ), line=self.lineno)
+            # store (docname, objtype, fullname) so we keep full object info
+            objects[fid] = (self.env.docname, self.objtype, fullname)
@@
-        indextext = '{} ({})'.format(fullname2namepath(fullname), _(self.objtype))
+        indextext = '{} ({})'.format(fullname2namepath(fullname), _(self.objtype))
         if (self.objtype == 'constructor' or
                 self.objtype == 'function' and fullname.name == '<fallback>'):
             glossary_classifier = (fullname.obj_path or ('?',))[-1][0].upper()
         else:
             glossary_classifier = fullname.name[:1].upper()
-        self.indexnode['entries'].append((
-            'single',
-            indextext,
-            fullname2id(fullname),
-            False,
-            glossary_classifier,
-        ))
+        self.indexnode['entries'].append((
+            'single',
+            indextext,
+            fid,
+            False,
+            glossary_classifier,
+        ))
@@
     def clear_doc(self, docname):
         # type: (unicode) -> None
-        for fullname, (fn, _l) in list(self.data['objects'].items()):
-            if fn == docname:
-                del self.data['objects'][fullname]
+        # keys are fid strings; values are (docname, objtype, fullname)
+        for fid, (fn, _objtype, _full) in list(self.data['objects'].items()):
+            if fn == docname:
+                del self.data['objects'][fid]
 
     def merge_domaindata(self, docnames, otherdata):
         # type: (List[unicode], Dict) -> None
         # XXX check duplicates
-        for fullname, (fn, objtype) in otherdata['objects'].items():
-            if fn in docnames:
-                self.data['objects'][fullname] = (fn, objtype)
+        # otherdata['objects'] stores fid -> (docname, objtype, fullname)
+        for fid, (fn, objtype, fullname) in otherdata.get('objects', {}).items():
+            if fn in docnames:
+                self.data['objects'][fid] = (fn, objtype, fullname)
 
     def resolve_xref(self, env, fromdocname, builder,
                      typ, target, node, contnode):
@@
-        for fullname, (docname, objtype) in self.data['objects'].items():
-            if fullname.name == target:
-                return make_refnode(builder, fromdocname, docname, fullname2id(fullname), contnode, fullname.name)
+        # stored items: fid -> (docname, objtype, fullname)
+        for fid, (docname, objtype, fullname) in self.data['objects'].items():
+            if fullname.name == target:
+                # fid is the id used in signode['ids'] (fullname2id(fullname))
+                return make_refnode(builder, fromdocname, docname, fid, contnode, fullname.name)
         return None
*** End Patch
